set -ex

# Set up r kernel
mkdir $HOME/RPackages
echo ".libPaths('$HOME/RPackages')" > $HOME/.Rprofile
R -e "install.packages(c('repr', 'IRdisplay', 'evaluate', 'crayon', 'pbdZMQ', 'devtools', 'uuid', 'digest', 'ggplot2'), lib='$HOME/RPackages', repos='http://cran.us.r-project.org')"
R -e "devtools::install_github('IRkernel/IRkernel', lib='$HOME/RPackages')"

conda install nbconvert
jupyter nbconvert --to notebook --execute  --ExecutePreprocessor.timeout=60 --stdout notebooks/R.ipynb > /dev/null;

invoke build --env-name=root
invoke demofiles
invoke talk -t demo
rm -rf demofiles
rm -rf notebooks
rm -rf narrative
rm -rf slides
rm demo/notebooks/Data.ipynb
rm demo/notebooks/Julia.ipynb
jupyter lab clean
